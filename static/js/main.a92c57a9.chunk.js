(this.webpackJsonpdse=this.webpackJsonpdse||[]).push([[0],{148:function(e,t,n){e.exports=n.p+"static/media/logo.743a2742.jpeg"},158:function(e,t,n){e.exports=n(867)},164:function(e,t,n){},867:function(e,t,n){"use strict";n.r(t);var o=n(6),i=n.n(o),r=n(37),a=n(0),c=n.n(a),s=n(53),u=n.n(s),l=(n(164),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function d(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var f=n(7),h=n(1),p=n(4),v=n(54),m=n(143),g=n(872),y=n(28),b=n.n(y),w=n(144),x=n.n(w),k=n(145),I=n.n(k),j=n(146),E=n.n(j),O=n(147),S=n.n(O);function N(e){return x()().use(b.a).use(I.a).processSync(e).toString()}function D(e){var t,n=S.a.expand(e),o=E.a.PorterStemmer.tokenizeAndStem(n),i={},r=Object(p.a)(o);try{for(r.s();!(t=r.n()).done;){var a=t.value;i[a]=void 0===i[a]?1:i[a]+1}}catch(l){r.e(l)}finally{r.f()}for(var c=0,s=Object.keys(i);c<s.length;c++){var u=s[c];i[u]=i[u]/o.length}return i}function A(e,t,n){!function(e,t,n){for(var o=0,i=Object.entries(t);o<i.length;o++){var r=Object(h.a)(i[o],2),a=r[0],c=r[1];void 0===n[a]&&(n[a]={}),n[a][e]=c}}(e,D(N(t)),n)}function C(e,t){for(var n=0,o=0,i=Object.keys(e);o<i.length;o++){var r=i[o];Object.keys(t).includes(r)&&(n+=1)}return n+function(e,t){for(var n=0,o=0,i=Object.keys(e);o<i.length;o++){var r=i[o];n+=(e[r]||0)*(t[r]||0)}return n}(e,t)}var U=function(){function e(t){Object(v.a)(this,e),this.db=void 0,this.root=void 0,this.currentIndexID=void 0,this.focus=void 0,this.mode=void 0,this.clipboard=void 0,this.selection=void 0,this.dirty=void 0,this.index=void 0,null===t?(this.root=Object(g.a)(),this.db={},this.db[this.root]={type:"index",contents:[]}):(this.root=t.root,this.db=t.db),""!==window.location.hash?(this.currentIndexID=window.location.hash.slice(1),this.focus=window.history.state.focus||-1):(this.currentIndexID=this.root,this.focus=-1),this.mode="viewing",this.clipboard=[],this.dirty=!1,this.index={};var n,o=Object(p.a)(this.notes());try{for(o.s();!(n=o.n()).done;){var i=Object(h.a)(n.value,2);A(i[0],i[1].contents,this.index)}}catch(r){o.e(r)}finally{o.f()}}return Object(m.a)(e,[{key:"save",value:function(){localStorage.setItem("database",JSON.stringify(this.snapshot)),console.log("Saved change to local storage"),this.dirty=!0}},{key:"notes",value:i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=i.a.keys(this.db);case 1:if((e.t1=e.t0()).done){e.next=10;break}if(t=e.t1.value,!Object.prototype.hasOwnProperty.call(this.db,t)){e.next=8;break}if("note"!==(n=this.db[t]).type){e.next=8;break}return e.next=8,[t,n];case 8:e.next=1;break;case 10:case"end":return e.stop()}}),e,this)}))},{key:"view",value:function(e,t){this.currentIndexID=e,this.focus=void 0===t?-1:t}},{key:"enter",value:function(e){var t=this.db[e].contents.length>0?0:-1;window.history.replaceState({focus:this.focus},"","#"+this.currentIndexID),window.history.pushState({focus:t},"","#"+e),this.view(e,t)}},{key:"goBack",value:function(){window.history.back()}},{key:"goForward",value:function(){window.history.forward()}},{key:"goUp",value:function(){"viewing"===this.mode&&this.focus>-1&&(this.focus=this.focus-1),"selecting"===this.mode&&this.focus>0&&(this.focus=this.focus-1)}},{key:"goDown",value:function(){this.focus<this.currentIndex.contents.length-1&&(this.focus=this.focus+1)}},{key:"search",value:function(e){var t=function(e,t){var n=D(e);if(0===Object.keys(n).length)return[];for(var o=new Map,i=0,r=Object.keys(n);i<r.length;i++)for(var a=r[i],c=t[a]||{},s=0,u=Object.entries(c);s<u.length;s++){var l=Object(h.a)(u[s],2),d=l[0],f=l[1],v=o.get(d)||{};v[a]=f,o.set(d,v)}var m,g=[],y=Object(p.a)(o.entries());try{for(y.s();!(m=y.n()).done;){var b=Object(h.a)(m.value,2),w=b[0],x=b[1];g.push([w,C(n,x)])}}catch(k){y.e(k)}finally{y.f()}return g.sort((function(e,t){return t[1]-e[1]})),g.map((function(e){var t=Object(h.a)(e,2),n=t[0];t[1];return n})).slice(0,30)}(e,this.index),n=this.newIndex();this.db[n].contents=t,this.enter(n),this.save()}},{key:"showRelatedNotes",value:function(){var e=this.focusedCard;if(void 0!==e&&"note"===e.type){var t=N(e.contents);this.search(t)}}},{key:"updateNote",value:function(e,t){var n=this.db[e];return!(!n||"note"!==n.type)&&(this.db[e]=Object(f.a)(Object(f.a)({},n),{},{contents:t}),!0)}},{key:"updateIndex",value:function(e,t){var n={type:"index",contents:this.db[e].contents.slice()};t(n),this.db[e]=n}},{key:"insertAfter",value:function(e,t){this.currentIndex.contents.splice(e+1,0,t);var n=this.currentIndexID;if(n.endsWith("-outgoing")){var o=n.substr(0,n.length-9);this.updateIndex(t+"-incoming",(function(e){e.contents.push(o)}))}if(n.endsWith("-incoming")){var i=n.substr(0,n.length-9);this.updateIndex(t+"-outgoing",(function(e){e.contents.push(i)}))}this.save()}},{key:"remove",value:function(e){var t=this.currentIndex.contents[e];this.updateIndex(this.currentIndexID,(function(t){t.contents.splice(e,1)})),this.focus>this.currentIndex.contents.length-1&&(this.focus=this.focus-1);var n=this.currentIndexID;if(n.endsWith("-outgoing")){var o=n.substr(0,n.length-9);this.updateIndex(t+"-incoming",(function(e){var t=e.contents.findIndex((function(e){return e===o}));e.contents.splice(t,1)}))}if(n.endsWith("-incoming")){var i=n.substr(0,n.length-9);this.updateIndex(t+"-outgoing",(function(e){var t=e.contents.findIndex((function(e){return e===i}));e.contents.splice(t,1)}))}this.save()}},{key:"newNote",value:function(){var e=Object(g.a)();return this.db[e]={type:"note",contents:""},this.db[e+"-incoming"]={type:"index",contents:[]},this.db[e+"-outgoing"]={type:"index",contents:[]},this.save(),e}},{key:"newIndex",value:function(){var e=Object(g.a)();return this.db[e]={type:"index",contents:[]},this.save(),e}},{key:"removeSelection",value:function(){if("viewing"===this.mode)this.remove(this.focus);else if("selecting"===this.mode){for(var e=Math.min(this.focus,this.selection),t=Math.max(this.focus,this.selection),n=e;n<=t;n++)this.remove(e);this.mode="viewing",this.selection=void 0,this.focus=e}this.focus>this.currentIndex.contents.length-1&&(this.focus=this.focus-1)}},{key:"copy",value:function(){if("viewing"===this.mode)this.clipboard=[this.focusedCardID];else if("selecting"===this.mode){var e=this.currentIndex,t=Math.min(this.focus,this.selection),n=Math.max(this.focus,this.selection);this.clipboard=[];for(var o=t;o<=n;o++)this.clipboard.push(e.contents[o])}}},{key:"paste",value:function(){for(var e=0;e<this.clipboard.length;e++)this.insertAfter(this.focus+e,this.clipboard[e])}},{key:"snapshot",get:function(){return{db:this.db,root:this.root,timestamp:Date.now()}}},{key:"currentIndex",get:function(){return this.db[this.currentIndexID]}},{key:"focusedCardID",get:function(){return this.currentIndex.contents[this.focus]}},{key:"focusedCard",get:function(){return this.focusedCardID?this.db[this.focusedCardID]:void 0}}]),e}(),R=(n(393),n(394),n(77)),W=n.n(R),M=n(78);function B(e){return new Promise((function(t,n){var o=new FileReader;o.onload=function(e){e&&e.target&&e.target.result?t(e.target.result):n("Blob had an unexpected format: blob.target.result is undefined\n"+e)},o.onerror=function(e){n(e)},o.readAsText(e)}))}function F(){var e=localStorage.getItem("dropbox_access_token");if(null!==e)return e;var t=function(e){var t=Object.create(null);return"string"!==typeof e?t:(e=e.trim().replace(/^(\?|#|&)/,""))?(e.split("&").forEach((function(e){var n=e.replace(/\+/g," ").split("="),o=n.shift(),i=n.length>0?n.join("="):void 0;o=decodeURIComponent(o);var r=void 0===i?null:decodeURIComponent(i);void 0===t[o]?t[o]=r:Array.isArray(t[o])?t[o].push(r):t[o]=[t[o],r]})),t):t}(window.location.hash).access_token;return t&&localStorage.setItem("dropbox_access_token",t),t}function _(){return!!F()}var J=_()?new M.Dropbox({fetch:W.a,accessToken:F()}):new M.Dropbox({fetch:W.a,clientId:"31ybvx3rsag1cih"});function T(){return(T=Object(r.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.dirty=!1,e.next=4,J.filesUpload({contents:JSON.stringify(t.snapshot),path:"/database.json",mode:{".tag":"overwrite"},mute:!0});case 4:n=e.sent,console.log("Upload successful"),console.log(n),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Upload failed!"),console.error(e.t0),t.dirty=!0;case 14:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function z(){return(z=Object(r.a)(i.a.mark((function e(){var t,n,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,J.filesDownload({path:"/database.json"});case 3:return t=e.sent,e.next=6,B(t.fileBlob);case 6:return n=e.sent,o=JSON.parse(n),e.abrupt("return",o);case 11:return e.prev=11,e.t0=e.catch(0),console.error("Error fetching data from cloud:"),console.error(e.t0),e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}var L=_()?{isAuthenticated:!0,upload:function(e){return T.apply(this,arguments)},download:function(){return z.apply(this,arguments)}}:{isAuthenticated:!1,authenticationURL:J.getAuthenticationUrl(window.location.toString())},P=n(156),G=n(155),K=n(148),q=n.n(K);function V(e){var t=e.dispatch,n=Object(a.useState)(""),o=Object(h.a)(n,2),i=o[0],r=o[1],s=Object(a.useRef)(null);return c.a.createElement("form",{className:"input-field",onSubmit:function(e){e.preventDefault(),t({type:"search",query:i}),s.current&&s.current.blur()}},c.a.createElement("i",{className:"material-icons prefix"},"search"),c.a.createElement("input",{id:"icon_prefix",type:"text",ref:s,onChange:function(e){return r(e.target.value)},onKeyDown:function(e){"Escape"===e.key&&s.current&&s.current.blur()}}),c.a.createElement("label",{htmlFor:"icon_prefix"},"Search"))}var $=n(55),H=n.n($),Q=n(56),X=n(79),Y=n(873),Z=n(871);function ee(e){e.scrollIntoView({behavior:"smooth",block:"center"})}var te={math:function(e){var t=e.value;return c.a.createElement(X.BlockMath,null,t)},inlineMath:function(e){var t=e.value;return c.a.createElement(X.InlineMath,null,t)},code:function(e){var t=e.language,n=e.value;return c.a.createElement(Y.a,{language:t,style:Z.a},n)}},ne=c.a.memo((function(e){var t=e.card;if("index"===t.type)return c.a.createElement("div",{className:"card-panel truncate"},"Index: (".concat(t.contents.length," cards)"));var n=t.contents.split(" "),o=n.length>20?n.slice(0,20).join(" ")+"...":t.contents;return c.a.createElement("div",{className:"card-panel"},c.a.createElement(H.a,{source:o,plugins:[b.a,Q.a],renderers:te}))})),oe=n(2),ie=n(59),re=n(157),ae=c.a.memo((function(e){var t=e.note,n=e.id,o=e.dispatch,i=Object(a.useRef)(null);i.current&&ee(i.current);var r=Object(a.useState)(se(t.contents)),s=Object(h.a)(r,2),u=s[0],l=s[1],d=Object(a.useMemo)((function(){return Object(re.a)(Object(ie.c)(Object(oe.i)()))}),[]);return c.a.createElement("div",{className:"card-panel z-depth-3 edited-note"},c.a.createElement(ie.b,{editor:d,value:u,onChange:function(e){l(e),o({type:"update note",id:n,contents:ce(e)})}},c.a.createElement(ie.a,{autoFocus:!0,onKeyDown:function(e){"Escape"===e.key&&o({type:"stop editing"})},placeholder:"Enter some text...",style:{marginTop:"14px",marginBottom:"14px"}})))})),ce=function(e){return e.map((function(e){return oe.c.string(e)})).join("\n")},se=function(e){return e.split("\n").map((function(e){return{children:[{text:e}]}}))},ue=c.a.memo((function(e){var t=e.card,n=e.id,o=e.isFocused,i=e.isSelected,r=["card-panel",o?"z-depth-3":"",i?"blue lighten-5":""].join(" "),s=Object(a.useRef)(null);return Object(a.useEffect)((function(){var e=s.current;e&&o&&(console.log("Scrolling to",n),setTimeout((function(){ee(e)}),20))})),c.a.createElement("div",{className:r,ref:s},c.a.createElement(H.a,{source:t.contents,plugins:[b.a,Q.a],renderers:te}))})),le=c.a.memo((function(e){var t=e.id,n=e.card,o=e.position,i=e.focus,r=e.selection,a=e.mode,s=e.dispatch,u=i===o,l="selecting"===a&&(i<=o&&o<=r||i>=o&&o>=r);return u&&"editing"===a?c.a.createElement(ae,{note:n,id:t,dispatch:s}):c.a.createElement(ue,{card:n,id:t,isFocused:u,isSelected:l})})),de={Enter:{type:"edit"},"command+c":{type:"copy"},"command+x":{type:"cut"},"command+v":{type:"paste"},"command+z":{type:"undo"},"command+shift+z":{type:"redo"},Space:{type:"new note"},right:{type:"right"},left:{type:"left"},up:{type:"up"},down:{type:"down"},Escape:{type:"back"},Backspace:{type:"remove"},"shift+down":{type:"select and go down"},"shift+up":{type:"select and go up"},"shift+f":{type:"find related notes"},j:{type:"down"},k:{type:"up"},h:{type:"left"},l:{type:"right"},"shift+h":{type:"back"},"shift+l":{type:"forward"},u:{type:"undo"},"ctrl+r":{type:"redo"},y:{type:"copy"},p:{type:"paste"},x:{type:"cut"},d:{type:"remove"},i:{type:"edit"},a:{type:"new note"}},fe=Object.keys(de).join(","),he=function(e){return function(t,n){n.preventDefault(),console.log(de[t]),e(de[t])}};function pe(){return c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col s3 offset-s4"},c.a.createElement("div",{className:"card-panel valign-wrapper"},c.a.createElement("b",{className:"center-align"},"Loading..."))))}function ve(){return L.isAuthenticated?null:c.a.createElement("div",{className:"card-panel"},c.a.createElement("a",{href:L.authenticationURL},"Sign in to Dropbox"))}function me(e,t){return t.contents.map((function(t,n){return c.a.createElement(ne,{key:n,card:e.db[t]})}))}function ge(e){var t=e.state,n=e.dispatch;if(null===t)return c.a.createElement(pe,null);var o=t.currentIndex.contents[t.focus],i=t.db[o+"-outgoing"],r=t.db[o+"-incoming"];return c.a.createElement(G.a,{keyName:fe,onKeyDown:he(n)},c.a.createElement("div",{className:"row"},c.a.createElement("div",{id:"left-panel",className:"pinned col l3 offset-l1 m3 hide-on-small-only"},c.a.createElement("a",{href:"/"},c.a.createElement("img",{id:"logo",src:q.a,alt:"Go home"})),r&&me(t,r)),c.a.createElement("div",{id:"main-panel",className:"col l4 offset-l4 m6 offset-m3 s10 offset-s1"},c.a.createElement(V,{dispatch:n}),c.a.createElement(ve,null),function(e,t){return e.currentIndex.contents.map((function(n,o){var i=e.db[n];if("note"!==i.type)throw Error("I only know how to render notes");return c.a.createElement(le,{key:o,id:n,position:o,mode:e.mode,focus:e.focus,selection:e.selection,card:i,dispatch:t})}))}(t,n)),c.a.createElement("div",{id:"right-panel",className:"pinned col l3 offset-l8 m3 offset-m9 hide-on-small-only"},i&&me(t,i))))}P.a();var ye=null;function be(){u.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(ge,{state:ye,dispatch:we})),document.getElementById("root"))}function we(e){if(null!==ye){if("search"===e.type&&ye.search(e.query),"viewing"===ye.mode)if("edit"===e.type&&ye.focus>=0)ye.mode="editing";else if("find related notes"===e.type&&ye.focus>=0)ye.showRelatedNotes();else if("back"===e.type)ye.goBack();else if("forward"===e.type)ye.goForward();else if("new note"===e.type){var t=ye.newNote();ye.insertAfter(ye.focus,t),ye.focus=ye.focus+1,ye.mode="editing"}else if("paste"===e.type)ye.paste();else if("right"===e.type&&ye.focus>=0){var n=ye.currentIndex.contents[ye.focus];ye.enter(n+"-outgoing")}else if("left"===e.type&&ye.focus>=0){var o=ye.currentIndex.contents[ye.focus];ye.enter(o+"-incoming")}if("viewing"!==ye.mode&&"selecting"!==ye.mode||("remove"===e.type&&ye.focus>=0?ye.removeSelection():"copy"===e.type&&ye.focus>=0?(ye.copy(),ye.mode="viewing",ye.selection=void 0):"cut"===e.type&&ye.focus>=0?(ye.copy(),ye.removeSelection()):"back"===e.type?(ye.mode="viewing",ye.selection=void 0):"up"===e.type?ye.goUp():"down"===e.type?ye.goDown():"select and go down"===e.type&&ye.focus>=0?(ye.mode="selecting",void 0===ye.selection&&(ye.selection=ye.focus),ye.goDown()):"select and go up"===e.type&&(ye.mode="selecting",void 0===ye.selection&&(ye.selection=ye.focus),ye.goUp())),"editing"===ye.mode)if("stop editing"===e.type)ye.mode="viewing",ye.save();else if("update note"===e.type){ye.updateNote(e.id,e.contents)||console.error("Cannot update card ".concat(e.id,": not a note"))}console.log(ye),be()}}L.isAuthenticated&&setInterval((function(){null!==ye&&ye.dirty&&L.upload(ye)}),1e4),Object(r.a)(i.a.mark((function e(){var t,n,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!L.isAuthenticated){e.next=6;break}return e.next=3,L.download();case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=null;case 7:(t=e.t0)&&console.log("Got cloud snapshot:",t),n=localStorage.getItem("database"),o=n?JSON.parse(n):null,console.log("Got snapshot from localstorage:",o),ye=null===o&&null===t?new U(null):null===o&&null!==t?new U(t):null!==o&&null===t?new U(o):o.timestamp<t.timestamp?new U(t):new U(o),be();case 14:case"end":return e.stop()}}),e)})))(),window.onpopstate=function(e){console.log("Entered index "+window.location.hash+" focus "+e.state.focus),ye&&(ye.view(window.location.hash.slice(1),e.state.focus),be())},be(),function(e){if("serviceWorker"in navigator){if(new URL("/carte-blanche",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/carte-blanche","/service-worker.js");l?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):d(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):d(t,e)}))}}()}},[[158,1,2]]]);
//# sourceMappingURL=main.a92c57a9.chunk.js.map