(this.webpackJsonpdse=this.webpackJsonpdse||[]).push([[0],{341:function(e,t,n){},544:function(e,t,n){"use strict";n.r(t);var o=n(4),s=n.n(o),i=n(13),c=n(1),r=n.n(c),a=n(18),u=n.n(a),l=n(31),d=n.n(l),h=n(32),f=n.n(h),m=n(33),p=n(549),v=n(548),g=n(34),b=n(57);n(341),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var y=n(19),w=n(51),x=n(550);var k=function(){function e(t){Object(y.a)(this,e),this.db=void 0,this.root=void 0,this.crumbs=void 0,this.mode=void 0,this.clipboard=void 0,this.selection=void 0,this.dirty=void 0,null===t?(this.root=Object(x.a)(),this.db={},this.db[this.root]={type:"index",contents:[]}):(this.root=t.root,this.db=t.db),this.crumbs=[[this.root,-1]],this.mode="viewing",this.clipboard=[],this.dirty=!1}return Object(w.a)(e,[{key:"save",value:function(){localStorage.setItem("database",JSON.stringify(this.snapshot)),console.log("Saved change to local storage"),this.dirty=!0}},{key:"enter",value:function(e){var t;t=this.db[e].contents.length>0?0:-1,this.crumbs.push([e,t])}},{key:"exit",value:function(){this.crumbs.length>1&&this.crumbs.pop()}},{key:"goUp",value:function(){"viewing"===this.mode&&this.focus>-1&&(this.focus=this.focus-1),"selecting"===this.mode&&this.focus>0&&(this.focus=this.focus-1)}},{key:"goDown",value:function(){this.focus<this.currentIndex.contents.length-1&&(this.focus=this.focus+1)}},{key:"insertAfter",value:function(e,t){this.currentIndex.contents.splice(e+1,0,t);var n=this.currentIndexID;if(n.endsWith("-outgoing")){var o=n.substr(0,n.length-9);this.db[t+"-incoming"].contents.push(o)}if(n.endsWith("-incoming")){var s=n.substr(0,n.length-9);this.db[t+"-outgoing"].contents.push(s)}this.save()}},{key:"remove",value:function(e){var t=this.currentIndex.contents[e];this.currentIndex.contents.splice(e,1),this.focus>this.currentIndex.contents.length-1&&(this.focus=this.focus-1);var n=this.currentIndexID;if(n.endsWith("-outgoing")){var o=n.substr(0,n.length-9),s=this.db[t+"-incoming"],i=s.contents.findIndex((function(e){return e===o}));s.contents.splice(i,1)}if(n.endsWith("-incoming")){var c=n.substr(0,n.length-9),r=this.db[t+"-outgoing"],a=r.contents.findIndex((function(e){return e===c}));r.contents.splice(a,1)}this.save()}},{key:"newNote",value:function(){var e=Object(x.a)();return this.db[e]={type:"note",contents:""},this.db[e+"-incoming"]={type:"index",contents:[]},this.db[e+"-outgoing"]={type:"index",contents:[]},this.save(),e}},{key:"newIndex",value:function(){var e=Object(x.a)();return this.db[e]={type:"index",contents:[]},this.save(),e}},{key:"removeSelection",value:function(){if("viewing"===this.mode)this.remove(this.focus);else if("selecting"===this.mode){for(var e=Math.min(this.focus,this.selection),t=Math.max(this.focus,this.selection),n=e;n<=t;n++)this.remove(e);this.mode="viewing",this.selection=void 0,this.focus=e}this.focus>this.currentIndex.contents.length-1&&(this.focus=this.focus-1)}},{key:"copy",value:function(){if("viewing"===this.mode)this.clipboard=[this.focusedCardID];else if("selecting"===this.mode){var e=this.currentIndex,t=Math.min(this.focus,this.selection),n=Math.max(this.focus,this.selection);this.clipboard=[];for(var o=t;o<=n;o++)this.clipboard.push(e.contents[o])}}},{key:"paste",value:function(){for(var e=0;e<this.clipboard.length;e++)this.insertAfter(this.focus+e,this.clipboard[e])}},{key:"snapshot",get:function(){return{db:this.db,root:this.root,timestamp:Date.now()}}},{key:"focus",get:function(){return this.crumbs[this.crumbs.length-1][1]},set:function(e){this.crumbs[this.crumbs.length-1][1]=e}},{key:"currentIndexID",get:function(){return this.crumbs[this.crumbs.length-1][0]}},{key:"currentIndex",get:function(){return this.db[this.currentIndexID]}},{key:"focusedCardID",get:function(){return this.currentIndex.contents[this.focus]}},{key:"focusedCard",get:function(){return this.focusedCardID?this.db[this.focusedCardID]:void 0}}]),e}(),E=(n(342),n(343),n(2)),I=n(22),j=n(58),N=function(e){return e.map((function(e){return E.c.string(e)})).join("\n")},D=function(e){return e.split("\n").map((function(e){return{children:[{text:e}]}}))},O=function(e){var t=Object(c.useMemo)((function(){return Object(j.a)(Object(I.c)(Object(E.i)()))}),[]);return r.a.createElement(I.b,{editor:t,value:D(e.note.contents),onChange:function(t){e.updateNote(e.id,N(t))}},r.a.createElement(I.a,{autoFocus:!0,onKeyDown:e.onKeyDown,placeholder:"Enter some text...",style:{marginTop:"14px",marginBottom:"14px"}}))},S=n(35),A=n.n(S),U=n(36);function C(e){return new Promise((function(t,n){var o=new FileReader;o.onload=function(e){e&&e.target&&e.target.result?t(e.target.result):n("Blob had an unexpected format: blob.target.result is undefined\n"+e)},o.onerror=function(e){n(e)},o.readAsText(e)}))}function M(){var e=localStorage.getItem("dropbox_access_token");if(null!==e)return e;var t=function(e){var t=Object.create(null);return"string"!==typeof e?t:(e=e.trim().replace(/^(\?|#|&)/,""))?(e.split("&").forEach((function(e){var n=e.replace(/\+/g," ").split("="),o=n.shift(),s=n.length>0?n.join("="):void 0;o=decodeURIComponent(o);var i=void 0===s?null:decodeURIComponent(s);void 0===t[o]?t[o]=i:Array.isArray(t[o])?t[o].push(i):t[o]=[t[o],i]})),t):t}(window.location.hash).access_token;return t&&localStorage.setItem("dropbox_access_token",t),t}function B(){return!!M()}var R=B()?new U.Dropbox({fetch:A.a,accessToken:M()}):new U.Dropbox({fetch:A.a,clientId:"31ybvx3rsag1cih"});function F(){return(F=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.dirty=!1,e.next=4,R.filesUpload({contents:JSON.stringify(t.snapshot),path:"/database.json",mode:{".tag":"overwrite"},mute:!0});case 4:n=e.sent,console.log("Upload successful"),console.log(n),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Upload failed!"),console.error(e.t0),t.dirty=!0;case 14:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function J(){return(J=Object(i.a)(s.a.mark((function e(){var t,n,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,R.filesDownload({path:"/database.json"});case 3:return t=e.sent,e.next=6,C(t.fileBlob);case 6:return n=e.sent,o=JSON.parse(n),e.abrupt("return",o);case 11:return e.prev=11,e.t0=e.catch(0),console.error("Error fetching data from cloud:"),console.error(e.t0),e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}var W=B()?{isAuthenticated:!0,upload:function(e){return F.apply(this,arguments)},download:function(){return J.apply(this,arguments)}}:{isAuthenticated:!1,authenticationURL:R.getAuthenticationUrl(window.location.toString())};function _(e){Q&&"Escape"===e.key&&(Q.mode="viewing",Q.save(),Z())}function z(e){e.scrollIntoView({behavior:"smooth",block:"center"})}function K(e){var t=e.note,n=e.id,o=Object(c.useRef)(null);return o.current&&z(o.current),r.a.createElement("div",{className:"card-panel z-depth-3"},r.a.createElement(O,{note:t,id:n,updateNote:Y,onKeyDown:_}))}var L={math:function(e){var t=e.value;return r.a.createElement(g.BlockMath,null,t)},inlineMath:function(e){var t=e.value;return r.a.createElement(g.InlineMath,null,t)},code:function(e){var t=e.language,n=e.value;return r.a.createElement(p.a,{language:t,style:v.a},n)}};function T(e){var t=["card-panel",e.isFocused?"z-depth-3":"",e.isSelected?"blue lighten-5":""].join(" "),n=Object(c.useRef)(null);return n.current&&e.isFocused&&z(n.current),r.a.createElement("div",{className:t,ref:n},r.a.createElement(d.a,{source:e.card.contents,plugins:[f.a,m.a],renderers:L}))}function G(e){var t=e.card,n=e.id,o=e.state,s=e.isFocused;return"index"===t.type?r.a.createElement("div",null,"Index: (".concat(t.contents.length," cards)")):s&&"editing"===o.mode?r.a.createElement(K,{note:t,id:n}):r.a.createElement(T,Object.assign({},e,{card:t}))}function P(e){var t=e.card;e.id,e.state;if("index"===t.type)return r.a.createElement("div",{className:"card-panel truncate"},"Index: (".concat(t.contents.length," cards)"));var n=t.contents.split(" "),o=n.length>20?n.slice(0,20).join(" ")+"...":t.contents;return r.a.createElement("div",{className:"card-panel"},r.a.createElement(d.a,{source:o,plugins:[f.a,m.a],renderers:L}))}function V(e){var t=e.state;if(null===t)return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s3 offset-s4"},r.a.createElement("div",{className:"card-panel valign-wrapper"},r.a.createElement("b",{className:"center-align"},"Loading..."))));var n=t.currentIndex.contents,o=n[t.focus],s=t.db[o+"-outgoing"],i=t.db[o+"-incoming"];return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"pinned col s3 offset-s1"},i&&i.contents.map((function(e,n){return r.a.createElement(P,{key:n,card:t.db[e],id:e,state:t})}))),r.a.createElement("div",{className:"col s4 offset-s4",style:{marginBottom:"20em"}},W.isAuthenticated||r.a.createElement("div",{className:"card-panel"},r.a.createElement("a",{href:W.authenticationURL},"Sign in to Dropbox")),n.map((function(e,n){var o=t.db[e],s=t.focus===n,i="selecting"===t.mode&&(t.focus<=n&&n<=t.selection||t.focus>=n&&n>=t.selection);return r.a.createElement(G,{id:e,card:o,key:n,state:t,isFocused:s,isSelected:i})}))),r.a.createElement("div",{className:"pinned col s3 offset-s8"},s&&s.contents.map((function(e,n){return r.a.createElement(P,{key:n,card:t.db[e],id:e,state:t})}))))}var $={Enter:"enter","command+c":"copy","command+x":"cut","command+v":"paste","command+z":"undo","command+shift+z":"redo",Space:"space",right:"right",left:"left",up:"up",down:"down",Escape:"escape",Backspace:"backspace","shift+down":"shift+down","shift+up":"shift+up",j:"down",k:"up",h:"left",l:"right",u:"undo","ctrl+r":"redo",y:"copy",p:"paste",x:"cut",d:"backspace",i:"enter",a:"space"},q=Object.keys($).join(",");function H(){return r.a.createElement(b.a,{keyName:q,onKeyDown:X},r.a.createElement(V,{state:Q}))}var Q=null;function X(e,t){Q&&(t.preventDefault(),console.log($[e]),function(e,t){if("viewing"===t.mode)if("enter"===e&&t.focus>=0)t.mode="editing";else if("escape"===e)t.exit();else if("space"===e){var n=t.newNote();t.insertAfter(t.focus,n),t.focus=t.focus+1,t.mode="editing"}else if("paste"===e)t.paste();else if("right"===e&&t.focus>=0){var o=t.currentIndex.contents[t.focus];t.enter(o+"-outgoing")}else if("left"===e&&t.focus>=0){var s=t.currentIndex.contents[t.focus];t.enter(s+"-incoming")}"viewing"!==t.mode&&"selecting"!==t.mode||("backspace"===e&&t.focus>=0?t.removeSelection():"copy"===e&&t.focus>=0?(t.copy(),t.mode="viewing",t.selection=void 0):"cut"===e&&t.focus>=0?(t.copy(),t.removeSelection()):"escape"===e?(t.mode="viewing",t.selection=void 0):"up"===e?t.goUp():"down"===e?t.goDown():"shift+down"===e&&t.focus>=0?(t.mode="selecting",void 0===t.selection&&(t.selection=t.focus),t.goDown()):"shift+up"===e&&(t.mode="selecting",void 0===t.selection&&(t.selection=t.focus),t.goUp())),"editing"===t.mode&&"escape"===e&&(t.mode="viewing")}($[e],Q),console.log(Q),Z())}function Y(e,t){if(Q){var n=Q.db[e];if("note"!==n.type)throw Error("Cannot update card ".concat(e,": not a note"));n.contents=t,Z()}}function Z(){u.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(H,null)),document.getElementById("root"))}W.isAuthenticated&&setInterval((function(){null!==Q&&Q.dirty&&W.upload(Q)}),1e4),Object(i.a)(s.a.mark((function e(){var t,n,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!W.isAuthenticated){e.next=6;break}return e.next=3,W.download();case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=null;case 7:(t=e.t0)&&console.log("Got cloud snapshot:",t),n=localStorage.getItem("database"),o=n?JSON.parse(n):null,console.log("Got snapshot from localstorage:",o),null===o&&null===t?Q=new k(null):null===t?Q=new k(o):(null===o||o.timestamp<t.timestamp)&&(Q=new k(t)),Z();case 14:case"end":return e.stop()}}),e)})))(),Z(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},59:function(e,t,n){e.exports=n(544)}},[[59,1,2]]]);
//# sourceMappingURL=main.cbf7a633.chunk.js.map