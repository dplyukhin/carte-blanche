(this.webpackJsonpdse=this.webpackJsonpdse||[]).push([[0],{341:function(e,t,n){},544:function(e,t,n){"use strict";n.r(t);var o=n(4),i=n.n(o),s=n(13),c=n(1),r=n.n(c),a=n(18),u=n.n(a),l=n(31),d=n.n(l),f=n(32),h=n.n(f),p=n(33),m=n(549),v=n(548),g=n(34),b=n(57),w=(n(341),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function y(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var x=n(19),k=n(51),E=n(550);var I=function(){function e(t){Object(x.a)(this,e),this.db=void 0,this.root=void 0,this.crumbs=void 0,this.mode=void 0,this.clipboard=void 0,this.selection=void 0,this.dirty=void 0,null===t?(this.root=Object(E.a)(),this.db={},this.db[this.root]={type:"index",contents:[]}):(this.root=t.root,this.db=t.db),this.crumbs=[[this.root,-1]],this.mode="viewing",this.clipboard=[],this.dirty=!1}return Object(k.a)(e,[{key:"save",value:function(){localStorage.setItem("database",JSON.stringify(this.snapshot)),console.log("Saved change to local storage"),this.dirty=!0}},{key:"enter",value:function(e){var t;t=this.db[e].contents.length>0?0:-1,this.crumbs.push([e,t])}},{key:"exit",value:function(){this.crumbs.length>1&&this.crumbs.pop()}},{key:"goUp",value:function(){"viewing"===this.mode&&this.focus>-1&&(this.focus=this.focus-1),"selecting"===this.mode&&this.focus>0&&(this.focus=this.focus-1)}},{key:"goDown",value:function(){this.focus<this.currentIndex.contents.length-1&&(this.focus=this.focus+1)}},{key:"insertAfter",value:function(e,t){this.currentIndex.contents.splice(e+1,0,t);var n=this.currentIndexID;if(n.endsWith("-outgoing")){var o=n.substr(0,n.length-9);this.db[t+"-incoming"].contents.push(o)}if(n.endsWith("-incoming")){var i=n.substr(0,n.length-9);this.db[t+"-outgoing"].contents.push(i)}this.save()}},{key:"remove",value:function(e){var t=this.currentIndex.contents[e];this.currentIndex.contents.splice(e,1),this.focus>this.currentIndex.contents.length-1&&(this.focus=this.focus-1);var n=this.currentIndexID;if(n.endsWith("-outgoing")){var o=n.substr(0,n.length-9),i=this.db[t+"-incoming"],s=i.contents.findIndex((function(e){return e===o}));i.contents.splice(s,1)}if(n.endsWith("-incoming")){var c=n.substr(0,n.length-9),r=this.db[t+"-outgoing"],a=r.contents.findIndex((function(e){return e===c}));r.contents.splice(a,1)}this.save()}},{key:"newNote",value:function(){var e=Object(E.a)();return this.db[e]={type:"note",contents:""},this.db[e+"-incoming"]={type:"index",contents:[]},this.db[e+"-outgoing"]={type:"index",contents:[]},this.save(),e}},{key:"newIndex",value:function(){var e=Object(E.a)();return this.db[e]={type:"index",contents:[]},this.save(),e}},{key:"removeSelection",value:function(){if("viewing"===this.mode)this.remove(this.focus);else if("selecting"===this.mode){for(var e=Math.min(this.focus,this.selection),t=Math.max(this.focus,this.selection),n=e;n<=t;n++)this.remove(e);this.mode="viewing",this.selection=void 0,this.focus=e}this.focus>this.currentIndex.contents.length-1&&(this.focus=this.focus-1)}},{key:"copy",value:function(){if("viewing"===this.mode)this.clipboard=[this.focusedCardID];else if("selecting"===this.mode){var e=this.currentIndex,t=Math.min(this.focus,this.selection),n=Math.max(this.focus,this.selection);this.clipboard=[];for(var o=t;o<=n;o++)this.clipboard.push(e.contents[o])}}},{key:"paste",value:function(){for(var e=0;e<this.clipboard.length;e++)this.insertAfter(this.focus+e,this.clipboard[e])}},{key:"snapshot",get:function(){return{db:this.db,root:this.root,timestamp:Date.now()}}},{key:"focus",get:function(){return this.crumbs[this.crumbs.length-1][1]},set:function(e){this.crumbs[this.crumbs.length-1][1]=e}},{key:"currentIndexID",get:function(){return this.crumbs[this.crumbs.length-1][0]}},{key:"currentIndex",get:function(){return this.db[this.currentIndexID]}},{key:"focusedCardID",get:function(){return this.currentIndex.contents[this.focus]}},{key:"focusedCard",get:function(){return this.focusedCardID?this.db[this.focusedCardID]:void 0}}]),e}(),j=(n(342),n(343),n(2)),N=n(22),O=n(58),S=function(e){return e.map((function(e){return j.c.string(e)})).join("\n")},D=function(e){return e.split("\n").map((function(e){return{children:[{text:e}]}}))},A=function(e){var t=Object(c.useMemo)((function(){return Object(O.a)(Object(N.c)(Object(j.i)()))}),[]);return r.a.createElement(N.b,{editor:t,value:D(e.note.contents),onChange:function(t){e.updateNote(e.id,S(t))}},r.a.createElement(N.a,{autoFocus:!0,onKeyDown:e.onKeyDown,placeholder:"Enter some text...",style:{marginTop:"14px",marginBottom:"14px"}}))},U=n(35),C=n.n(U),W=n(36);function R(e){return new Promise((function(t,n){var o=new FileReader;o.onload=function(e){e&&e.target&&e.target.result?t(e.target.result):n("Blob had an unexpected format: blob.target.result is undefined\n"+e)},o.onerror=function(e){n(e)},o.readAsText(e)}))}function M(){var e=localStorage.getItem("dropbox_access_token");if(null!==e)return e;var t=function(e){var t=Object.create(null);return"string"!==typeof e?t:(e=e.trim().replace(/^(\?|#|&)/,""))?(e.split("&").forEach((function(e){var n=e.replace(/\+/g," ").split("="),o=n.shift(),i=n.length>0?n.join("="):void 0;o=decodeURIComponent(o);var s=void 0===i?null:decodeURIComponent(i);void 0===t[o]?t[o]=s:Array.isArray(t[o])?t[o].push(s):t[o]=[t[o],s]})),t):t}(window.location.hash).access_token;return t&&localStorage.setItem("dropbox_access_token",t),t}function B(){return!!M()}var F=B()?new W.Dropbox({fetch:C.a,accessToken:M()}):new W.Dropbox({fetch:C.a,clientId:"31ybvx3rsag1cih"});function J(){return(J=Object(s.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.dirty=!1,e.next=4,F.filesUpload({contents:JSON.stringify(t.snapshot),path:"/database.json",mode:{".tag":"overwrite"},mute:!0});case 4:n=e.sent,console.log("Upload successful"),console.log(n),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Upload failed!"),console.error(e.t0),t.dirty=!0;case 14:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function T(){return(T=Object(s.a)(i.a.mark((function e(){var t,n,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.filesDownload({path:"/database.json"});case 3:return t=e.sent,e.next=6,R(t.fileBlob);case 6:return n=e.sent,o=JSON.parse(n),e.abrupt("return",o);case 11:return e.prev=11,e.t0=e.catch(0),console.error("Error fetching data from cloud:"),console.error(e.t0),e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}var L=B()?{isAuthenticated:!0,upload:function(e){return J.apply(this,arguments)},download:function(){return T.apply(this,arguments)}}:{isAuthenticated:!1,authenticationURL:F.getAuthenticationUrl(window.location.toString())};function _(e){Y&&"Escape"===e.key&&(Y.mode="viewing",Y.save(),te())}function z(e){e.scrollIntoView({behavior:"smooth",block:"center"})}function K(e){var t=e.note,n=e.id,o=Object(c.useRef)(null);return o.current&&z(o.current),r.a.createElement("div",{className:"card-panel z-depth-3"},r.a.createElement(A,{note:t,id:n,updateNote:ee,onKeyDown:_}))}var P={math:function(e){var t=e.value;return r.a.createElement(g.BlockMath,null,t)},inlineMath:function(e){var t=e.value;return r.a.createElement(g.InlineMath,null,t)},code:function(e){var t=e.language,n=e.value;return r.a.createElement(m.a,{language:t,style:v.a},n)}};function G(e){var t=["card-panel",e.isFocused?"z-depth-3":"",e.isSelected?"blue lighten-5":""].join(" "),n=Object(c.useRef)(null);return Object(c.useEffect)((function(){n.current&&e.isFocused&&(console.log("Scrolling to",e.id),setTimeout((function(){z(n.current)}),20))})),r.a.createElement("div",{className:t,ref:n},r.a.createElement(d.a,{source:e.card.contents,plugins:[h.a,p.a],renderers:P}))}function V(e){var t=e.card,n=e.id,o=e.state,i=e.isFocused;return"index"===t.type?r.a.createElement("div",null,"Index: (".concat(t.contents.length," cards)")):i&&"editing"===o.mode?r.a.createElement(K,{note:t,id:n}):r.a.createElement(G,Object.assign({},e,{card:t}))}function $(e){var t=e.card;e.id,e.state;if("index"===t.type)return r.a.createElement("div",{className:"card-panel truncate"},"Index: (".concat(t.contents.length," cards)"));var n=t.contents.split(" "),o=n.length>20?n.slice(0,20).join(" ")+"...":t.contents;return r.a.createElement("div",{className:"card-panel"},r.a.createElement(d.a,{source:o,plugins:[h.a,p.a],renderers:P}))}function q(e){var t=e.state;if(null===t)return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s3 offset-s4"},r.a.createElement("div",{className:"card-panel valign-wrapper"},r.a.createElement("b",{className:"center-align"},"Loading..."))));var n=t.currentIndex.contents,o=n[t.focus],i=t.db[o+"-outgoing"],s=t.db[o+"-incoming"];return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"pinned col l3 offset-l1 m3 hide-on-small-only"},s&&s.contents.map((function(e,n){return r.a.createElement($,{key:n,card:t.db[e],id:e,state:t})}))),r.a.createElement("div",{className:"col l4 offset-l4 m6 offset-m3 s10 offset-s1",style:{marginBottom:"20em"}},L.isAuthenticated||r.a.createElement("div",{className:"card-panel"},r.a.createElement("a",{href:L.authenticationURL},"Sign in to Dropbox")),n.map((function(e,n){var o=t.db[e],i=t.focus===n,s="selecting"===t.mode&&(t.focus<=n&&n<=t.selection||t.focus>=n&&n>=t.selection);return r.a.createElement(V,{id:e,card:o,key:n,state:t,isFocused:i,isSelected:s})}))),r.a.createElement("div",{className:"pinned col l3 offset-l8 m3 offset-m9 hide-on-small-only"},i&&i.contents.map((function(e,n){return r.a.createElement($,{key:n,card:t.db[e],id:e,state:t})}))))}var H={Enter:"enter","command+c":"copy","command+x":"cut","command+v":"paste","command+z":"undo","command+shift+z":"redo",Space:"space",right:"right",left:"left",up:"up",down:"down",Escape:"escape",Backspace:"backspace","shift+down":"shift+down","shift+up":"shift+up",j:"down",k:"up",h:"left",l:"right",u:"undo","ctrl+r":"redo",y:"copy",p:"paste",x:"cut",d:"backspace",i:"enter",a:"space"},Q=Object.keys(H).join(",");function X(){return r.a.createElement(b.a,{keyName:Q,onKeyDown:Z},r.a.createElement(q,{state:Y}))}var Y=null;function Z(e,t){Y&&(t.preventDefault(),console.log(H[e]),function(e,t){if("viewing"===t.mode)if("enter"===e&&t.focus>=0)t.mode="editing";else if("escape"===e)t.exit();else if("space"===e){var n=t.newNote();t.insertAfter(t.focus,n),t.focus=t.focus+1,t.mode="editing"}else if("paste"===e)t.paste();else if("right"===e&&t.focus>=0){var o=t.currentIndex.contents[t.focus];t.enter(o+"-outgoing")}else if("left"===e&&t.focus>=0){var i=t.currentIndex.contents[t.focus];t.enter(i+"-incoming")}"viewing"!==t.mode&&"selecting"!==t.mode||("backspace"===e&&t.focus>=0?t.removeSelection():"copy"===e&&t.focus>=0?(t.copy(),t.mode="viewing",t.selection=void 0):"cut"===e&&t.focus>=0?(t.copy(),t.removeSelection()):"escape"===e?(t.mode="viewing",t.selection=void 0):"up"===e?t.goUp():"down"===e?t.goDown():"shift+down"===e&&t.focus>=0?(t.mode="selecting",void 0===t.selection&&(t.selection=t.focus),t.goDown()):"shift+up"===e&&(t.mode="selecting",void 0===t.selection&&(t.selection=t.focus),t.goUp())),"editing"===t.mode&&"escape"===e&&(t.mode="viewing")}(H[e],Y),console.log(Y),te())}function ee(e,t){if(Y){var n=Y.db[e];if("note"!==n.type)throw Error("Cannot update card ".concat(e,": not a note"));n.contents=t,te()}}function te(){u.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(X,null)),document.getElementById("root"))}L.isAuthenticated&&setInterval((function(){null!==Y&&Y.dirty&&L.upload(Y)}),1e4),Object(s.a)(i.a.mark((function e(){var t,n,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!L.isAuthenticated){e.next=6;break}return e.next=3,L.download();case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=null;case 7:(t=e.t0)&&console.log("Got cloud snapshot:",t),n=localStorage.getItem("database"),o=n?JSON.parse(n):null,console.log("Got snapshot from localstorage:",o),null===o&&null===t?Y=new I(null):null===t?Y=new I(o):(null===o||o.timestamp<t.timestamp)&&(Y=new I(t)),te();case 14:case"end":return e.stop()}}),e)})))(),te(),function(e){if("serviceWorker"in navigator){if(new URL("/carte-blanche",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/carte-blanche","/service-worker.js");w?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):y(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):y(t,e)}))}}()},59:function(e,t,n){e.exports=n(544)}},[[59,1,2]]]);
//# sourceMappingURL=main.b4d582b9.chunk.js.map